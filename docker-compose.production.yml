# Docker Compose para Acuarela - PRODUCCIÓN

services:
  acuarela-web:
    build:
      context: .
      dockerfile: Dockerfile.production
    container_name: acuarela-web-prod
    ports:
      - "80:80"
      - "443:443"
    volumes:
      # Solo logs y uploads (NO montar todo el código)
      - ./logs:/var/log/apache2:rw
      - ./miembros/cron/logs:/var/www/html/miembros/cron/logs:rw
      - acuarela_uploads:/var/www/html/uploads:rw
      - php_sessions:/tmp:rw
      # Certificados SSL (Cloudflare Origin)
      - ./certs/acuarela.crt:/etc/ssl/certs/acuarela.crt:ro
      - ./certs/acuarela.key:/etc/ssl/certs/acuarela.key:ro
    environment:
      - APACHE_DOCUMENT_ROOT=/var/www/html
      - APACHE_RUN_USER=www-data
      - APACHE_RUN_GROUP=www-data
      - TZ=America/New_York
    restart: always
    networks:
      - acuarela-network
    labels:
      - "com.acuarela.environment=production"
      - "com.acuarela.version=1.0.0"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

networks:
  acuarela-network:
    driver: bridge

volumes:
  php_sessions:
    driver: local
  acuarela_uploads:
    driver: local
