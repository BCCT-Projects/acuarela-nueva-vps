# Configuración de Apache - PRODUCCIÓN con soporte IP y Dominio
<VirtualHost *:80>
    ServerAdmin webmaster@acuarela.app
    
    # Configuración de Dominios
    ServerName acuarela.app
    ServerAlias www.acuarela.app
    ServerAlias 152.42.152.212
    
    DocumentRoot /var/www/html

    <Directory /var/www/html>
        Options -Indexes +FollowSymLinks -MultiViews
        AllowOverride All
        Require all granted
        DirectoryIndex index.php index.html
    </Directory>

    # Seguridad: Bloquear acceso a archivos sensibles
    <FilesMatch "^\.">
        Require all denied
    </FilesMatch>
    
    <FilesMatch "\.(env|ini|log|md|git.*)$">
        Require all denied
    </FilesMatch>

    # Configuración para archivos CSS
    <FilesMatch "\.css$">
        Header set Content-Type "text/css; charset=UTF-8"
        Header set Cache-Control "public, max-age=604800, immutable"
        Header set X-Content-Type-Options "nosniff"
        Header always set Access-Control-Allow-Origin "*"
        Header always set Access-Control-Allow-Methods "GET, OPTIONS"
    </FilesMatch>

    # Configuración para archivos JavaScript
    <FilesMatch "\.js$">
        Header set Content-Type "application/javascript; charset=UTF-8"
        Header set Cache-Control "public, max-age=604800, immutable"
        Header set X-Content-Type-Options "nosniff"
    </FilesMatch>

    # Configuración para fuentes
    <FilesMatch "\.(ttf|otf|eot|woff|woff2)$">
        Header set Access-Control-Allow-Origin "*"
        Header set Cache-Control "public, max-age=31536000, immutable"
    </FilesMatch>

    # Configuración para imágenes
    <FilesMatch "\.(jpg|jpeg|png|gif|svg|ico|webp)$">
        Header set Cache-Control "public, max-age=2592000, immutable"
    </FilesMatch>

    # Compresión gzip para mejorar rendimiento
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript
        AddOutputFilterByType DEFLATE application/javascript application/json application/xml
        AddOutputFilterByType DEFLATE application/rss+xml application/atom+xml
        AddOutputFilterByType DEFLATE image/svg+xml
    </IfModule>

    # Seguridad adicional
    <IfModule mod_headers.c>
        # Prevenir clickjacking
        Header always set X-Frame-Options "SAMEORIGIN"
        
        # Prevenir MIME type sniffing
        Header always set X-Content-Type-Options "nosniff"
        
        # Habilitar protección XSS del navegador
        Header always set X-XSS-Protection "1; mode=block"
        
        # Nunca enviar el referer a HTTP desde HTTPS
        Header always set Referrer-Policy "strict-origin-when-cross-origin"
        
        # Política de permisos (ajustar según necesites)
        Header always set Permissions-Policy "geolocation=(), microphone=(), camera=()"
    </IfModule>

    # Logs
    ErrorLog ${APACHE_LOG_DIR}/acuarela_error.log
    CustomLog ${APACHE_LOG_DIR}/acuarela_access.log combined
    
    # Log level para producción (cambiar a 'warn' después de estabilizar)
    LogLevel warn
</VirtualHost>

# Configuración HTTPS (descomentar cuando tengas certificado SSL)
# <VirtualHost *:443>
#     ServerAdmin webmaster@acuarela.app
#     ServerName acuarela.app
#     ServerAlias www.acuarela.app
#     
#     DocumentRoot /var/www/html
#     
#     # Mismo Directory y FilesMatch que arriba
#     <Directory /var/www/html>
#         Options -Indexes +FollowSymLinks -MultiViews
#         AllowOverride All
#         Require all granted
#         DirectoryIndex index.php index.html
#     </Directory>
#     
#     # SSL Configuration
#     SSLEngine on
#     SSLCertificateFile /etc/ssl/certs/acuarela.crt
#     SSLCertificateKeyFile /etc/ssl/private/acuarela.key
#     SSLCertificateChainFile /etc/ssl/certs/acuarela-chain.crt
#     
#     # Modern SSL configuration
#     SSLProtocol all -SSLv3 -TLSv1 -TLSv1.1
#     SSLCipherSuite HIGH:!aNULL:!MD5
#     SSLHonorCipherOrder on
#     
#     # HSTS (descomenta después de confirmar que todo funciona)
#     # Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
#     
#     ErrorLog ${APACHE_LOG_DIR}/acuarela_ssl_error.log
#     CustomLog ${APACHE_LOG_DIR}/acuarela_ssl_access.log combined
# </VirtualHost>
